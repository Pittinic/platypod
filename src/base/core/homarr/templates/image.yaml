resources:
  # https://github.com/pulumi/pulumi-docker-build/blob/main/examples/yaml/Pulumi.yaml
  docker-image-homarr:
    type: docker-build:Image
    options:
      dependsOn:
      - ${docker-image-builder}
    properties:
      buildArgs:
        BUILDER_IMAGE: builder:current
        SOURCE_IMAGE: ${docker.build.registry}${docker.build.namespace}${homarr.image.repository}:${homarr.image.tag}
        WHOAMI_URL: ${urls.prefix}${whoami.name}${urls.suffix}.${domain}
        JELLYFIN_HOST: ${urls.prefix}${jellyfin.name}${urls.suffix}.${domain}
        JELLYFIN_USERNAME: ${jellyfin.credentials.username}
        JELLYFIN_PASSWORD: ${jellyfin.credentials.password}
      context:
        location: src/base/core/homarr/images
        named:
          builder:current:
            location: docker-image://${docker.build.registry}${docker.build.namespace}${image-builder.name}:${image-builder.tag}
      exports: ${docker.exports}
      dockerfile:
        location: src/base/core/homarr/images/Dockerfile
      platforms: ${docker.build.platforms}
      push: ${docker.build.push}
      registries: ${docker.registries}
      tags:
      - ${docker.build.registry}${docker.build.namespace}${homarr.image.repository}:${homarr.image.tag}
