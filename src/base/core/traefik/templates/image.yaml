resources:
  # https://github.com/pulumi/pulumi-docker-build/blob/main/examples/yaml/Pulumi.yaml
  docker-image-traefik:
    type: docker-build:Image
    options:
      dependsOn:
      - ${docker-image-builder}
    properties:
      buildArgs:
        BUILDER_IMAGE: builder:current
        SOURCE_IMAGE: ${traefik.image.registry}${traefik.image.namespace}${traefik.image.repository}:${traefik.image.tag}
        JELLYFIN_CERT_RESOLVER: ${traefik.tls-resolver-name}
        JELLYFIN_ENTRYPOINT: ${traefik.ports.https.name}
        JELLYFIN_HOST: ${jellyfin.host}
        JELLYFIN_PORT: ${jellyfin.port}
        JELLYFIN_SERVICE_NAME: ${jellyfin.name}
        JELLYFIN_URL: ${urls.prefix}${jellyfin.name}${urls.suffix}.${domain}
      context:
        location: src/base/core/traefik/images
        named:
          builder:current:
            location: docker-image://${docker.build.registry}${docker.build.namespace}${image-builder.name}:${image-builder.tag}
      dockerfile:
        location: src/base/core/traefik/images/Dockerfile
      exports: ${docker.exports}
      platforms: ${docker.build.platforms}
      push: ${docker.build.push}
      registries: ${docker.registries}
      tags:
      - ${docker.build.registry}${docker.build.namespace}${traefik.image.repository}:${traefik.image.tag}
